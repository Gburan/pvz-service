# Link Shortener Service

## 1. Description

Сервис для работы с ПВЗ

1. Метод `POST`, который сохраняет оригинальный URL в базе и возвращает сокращённый.
2. Метод `GET`, который принимает сокращённый URL и возвращает оригинальный URL.

1. Метод `/dummyLogin`: Принимает тип пользователя (client, moderator) и возвращает токен с соответствующим уровнем
   доступа (обычный пользователь или модератор).
2. Метод `/register`: Принимает данные для регистрации пользователя (почта, пароль и тип — client или moderator).
   Создаёт пользователя и возвращает токен для авторизации.
3. Метод `/login`: Принимает почту и пароль, возвращает токен для авторизованного пользователя с соответствующим уровнем
   доступа.
4. Метод `/createPickupPoint`: Только для модераторов. Принимает данные для создания нового ПВЗ в одном из трёх
   городов (Москва, Санкт-Петербург, Казань). Возвращает полную информацию о созданном ПВЗ или ошибку, если город не
   подходит.
5. Метод `/initiateGoodsReception`: Только для авторизованных пользователей с ролью «сотрудник ПВЗ». Инициализирует
   приём товара в ПВЗ. Возвращает результат операции или ошибку, если предыдущий приём не был закрыт.
6. Метод `/addGoodsToReception`: Только для авторизованных пользователей с ролью «сотрудник ПВЗ». Добавляет товары в
   текущую приёмку товаров. Возвращает ошибку, если нет незакрытой приёмки.
7. Метод `/removeGoodsFromReception`: Только для авторизованных пользователей с ролью «сотрудник ПВЗ». Удаляет товары из
   незакрытой приёмки по принципу LIFO (последний добавленный товар удаляется первым).
8. Метод `/closeReception`: Только для авторизованных пользователей с ролью «сотрудник ПВЗ». Закрывает текущую приёмку
   товаров. Возвращает ошибку, если приёмка уже была закрыта.
9. Метод `/getPickupPoints`: Только для авторизованных пользователей с ролью «сотрудник ПВЗ» или «модератор». Возвращает
   список ПВЗ с информацией о приёмке товаров за указанный период времени, с поддержкой пагинации.

## 2. Configuration

| Name               | Type   | Default value                             | Description                             |
|--------------------|--------|-------------------------------------------|-----------------------------------------|
| SERVER_ADDRESS     | String | `:8080`                                   | HTTP server address                     |
| POSTGRES_CONN      | String |                                           | PostgreSQL connection string            |
| ALLOWED_CATEGORIES | List   | `["электроника", "одежда", "обувь"]`      | List of allowed product categories      |
| ALLOWED_CITIES     | List   | `["Москва", "Санкт-Петербург", "Казань"]` | List of allowed cities                  |
| ALLOWED_USERS      | List   | `["moderator", "employee"]`               | List of allowed user roles              |
| JWT_TOKEN          | String |                                           | Predefined JWT token for authentication |

## 3. How to run

```
docker-compose up -d
```

или

```
make run-compose
```

или (с пересборкой контейнера)

```
make run-compose-b
```

## 4. Tests

### 4.1 Generate mocks

```
go generate ./...
```

или

```
make gen-mocks
```

### 4.2 Run tests

```
go test ./...
```

или

```
make run-test-clean
```